(()=>{"use strict";function e(e,t){console.log(`[Design System Analyzer] ${e}`,t||"")}function t(e,t,n){const o=e=>{const t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t};return`#${o(e)}${o(t)}${o(n)}`}function n(o,s){if(e("Processing node:",{type:o.type,name:o.name}),"fills"in o&&o.fills&&function(e,n){e.forEach((e=>{var o;if("SOLID"===e.type){const s=t(e.color.r,e.color.g,e.color.b);let i;if("boundVariables"in e&&(null===(o=e.boundVariables)||void 0===o?void 0:o.color)){const t=figma.variables.getVariableById(e.boundVariables.color.id);t&&(i=t.name)}let c=n.colors.find((e=>e.hex===s));c||(c={hex:s,variableName:i,directUses:0,variableUses:0},n.colors.push(c)),i?c.variableUses++:c.directUses++}else if("GRADIENT_LINEAR"===e.type||"GRADIENT_RADIAL"===e.type){const o=e.gradientStops.map((e=>t(e.color.r,e.color.g,e.color.b))),s=`${e.type} (${o.join(" â†’ ")})`;n.colors.some((e=>e.hex===s))||n.colors.push({hex:s,directUses:1,variableUses:0})}}))}(o.fills,s),"TEXT"===o.type){const t=o;if(e("Processing text node:",{styleId:t.textStyleId}),t.textStyleId&&"string"==typeof t.textStyleId){const n=figma.getStyleById(t.textStyleId);n&&!s.textStyles.includes(n.name)&&(s.textStyles.push(n.name),e("Added text style:",n.name))}}if("effects"in o&&o.effects&&function(e,t){e.forEach((e=>{let n="";"DROP_SHADOW"===e.type||"INNER_SHADOW"===e.type?n=`${e.type} (${e.color.r}, ${e.color.g}, ${e.color.b}, ${e.color.a})`:"LAYER_BLUR"!==e.type&&"BACKGROUND_BLUR"!==e.type||(n=`${e.type} (${e.radius}px)`),n&&!t.effects.includes(n)&&t.effects.push(n)}))}(o.effects,s),"children"in o){const t=o.children;e("Processing children:",t.length),t.forEach((e=>n(e,s)))}}function o(t,n,s){"COMPONENT"!==t.type&&"COMPONENT_SET"!==t.type||s.has(t.id)||(n.push({name:t.name,type:t.type}),s.add(t.id),e("Added component:",{name:t.name,type:t.type})),"children"in t&&t.children.forEach((e=>o(e,n,s)))}figma.showUI(__html__,{width:400,height:600}),figma.ui.onmessage=t=>{return s=void 0,i=void 0,l=function*(){if("analyze-design-system"===t.type)try{if(e("Starting analysis..."),0===figma.currentPage.selection.length)throw new Error("Please select at least one frame or component to analyze.");e("Selection found:",figma.currentPage.selection.length);const t={colors:[],textStyles:[],effects:[]},s=[],i=new Set;figma.currentPage.selection.forEach((e=>{o(e,s,i),n(e,t)}));const c=[];0===s.length&&c.push("No components found in selection"),0===t.colors.length&&c.push("No colors found in selection"),0===t.textStyles.length&&c.push("No text styles found in selection"),0===t.effects.length&&c.push("No effects found in selection"),e("Analysis complete:",{components:s.length,colors:t.colors.length,textStyles:t.textStyles.length,effects:t.effects.length,inconsistencies:c.length});const l={components:s,styles:t,inconsistencies:c};figma.ui.postMessage({type:"analysis-results",data:l})}catch(t){e("Error during analysis:",t),figma.ui.postMessage({type:"error",message:t instanceof Error?t.message:"An unknown error occurred"})}},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof c?s:new c((function(e){e(s)}))).then(n,o)}r((l=l.apply(s,i||[])).next())}));var s,i,c,l}})();